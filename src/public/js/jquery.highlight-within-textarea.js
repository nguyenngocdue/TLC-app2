/*! For license information please see jquery.highlight-within-textarea.js.LICENSE.txt */
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}var e,r,i;e=jQuery,r="hwt",(i=function(t,e){this.init(t,e)}).prototype={init:function(t,e){this.$el=t,"function"===this.getType(e)&&(e={highlight:e}),"custom"===this.getType(e)?(this.highlight=e,this.generate()):console.error("valid config object not provided")},getType:function(e){var r=t(e);if(!e)return"falsey";if(Array.isArray(e))return 2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]?"range":"array";if("object"===r){if(e instanceof RegExp)return"regexp";if(e.hasOwnProperty("highlight"))return"custom"}else if("function"===r||"string"===r)return r;return"other"},generate:function(){switch(this.$el.addClass("hwt-input hwt-content").on("input."+r,this.handleInput.bind(this)).on("scroll."+r,this.handleScroll.bind(this)),this.$highlights=e("<div>",{class:"hwt-highlights hwt-content"}),this.$backdrop=e("<div>",{class:r+"-backdrop"}).append(this.$highlights),this.$container=e("<div>",{class:r+"-container"}).insertAfter(this.$el).append(this.$backdrop,this.$el).on("scroll",this.blockContainerScroll.bind(this)),this.browser=this.detectBrowser(),this.browser){case"firefox":this.fixFirefox();break;case"ios":this.fixIOS()}this.isGenerated=!0,this.handleInput()},detectBrowser:function(){var t=window.navigator.userAgent.toLowerCase();return-1!==t.indexOf("firefox")?"firefox":t.match(/msie|trident\/7|edge/)?"ie":t.match(/ipad|iphone|ipod/)&&-1===t.indexOf("windows phone")?"ios":"other"},fixFirefox:function(){var t=this.$highlights.css(["padding-top","padding-right","padding-bottom","padding-left"]),e=this.$highlights.css(["border-top-width","border-right-width","border-bottom-width","border-left-width"]);this.$highlights.css({padding:"0","border-width":"0"}),this.$backdrop.css({"margin-top":"+="+t["padding-top"],"margin-right":"+="+t["padding-right"],"margin-bottom":"+="+t["padding-bottom"],"margin-left":"+="+t["padding-left"]}).css({"margin-top":"+="+e["border-top-width"],"margin-right":"+="+e["border-right-width"],"margin-bottom":"+="+e["border-bottom-width"],"margin-left":"+="+e["border-left-width"]})},fixIOS:function(){this.$highlights.css({"padding-left":"+=3px","padding-right":"+=3px"})},handleInput:function(){var t=this.$el.val(),e=this.getRanges(t,this.highlight),r=this.removeStaggeredRanges(e),i=this.getBoundaries(r);this.renderMarks(i)},getRanges:function(t,e){switch(this.getType(e)){case"array":return this.getArrayRanges(t,e);case"function":return this.getFunctionRanges(t,e);case"regexp":return this.getRegExpRanges(t,e);case"string":return this.getStringRanges(t,e);case"range":return this.getRangeRanges(t,e);case"custom":return this.getCustomRanges(t,e);default:if(!e)return[];console.error("unrecognized highlight type")}},getArrayRanges:function(t,e){var r=e.map(this.getRanges.bind(this,t));return Array.prototype.concat.apply([],r)},getFunctionRanges:function(t,e){return this.getRanges(t,e(t))},getRegExpRanges:function(t,e){for(var r,i=[];null!==(r=e.exec(t))&&(i.push([r.index,r.index+r[0].length]),e.global););return i},getStringRanges:function(t,e){for(var r=[],i=t.toLowerCase(),n=e.toLowerCase(),s=0;-1!==(s=i.indexOf(n,s));)r.push([s,s+n.length]),s+=n.length;return r},getRangeRanges:function(t,e){return[e]},getCustomRanges:function(t,e){var r=this.getRanges(t,e.highlight);return e.className&&r.forEach((function(t){t.className?t.className=e.className+" "+t.className:t.className=e.className})),r},removeStaggeredRanges:function(t){var e=[];return t.forEach((function(t){e.some((function(e){return(t[0]>e[0]&&t[0]<e[1])!=(t[1]>e[0]&&t[1]<e[1])}))||e.push(t)})),e},getBoundaries:function(t){var e=[];return t.forEach((function(t){e.push({type:"start",index:t[0],className:t.className}),e.push({type:"stop",index:t[1]})})),this.sortBoundaries(e),e},sortBoundaries:function(t){t.sort((function(t,e){return t.index!==e.index?e.index-t.index:"stop"===t.type&&"start"===e.type?1:"start"===t.type&&"stop"===e.type?-1:0}))},renderMarks:function(t){var e=this.$el.val();t.forEach((function(t,r){var i;i="start"===t.type?"{{hwt-mark-start|"+r+"}}":"{{hwt-mark-stop}}",e=e.slice(0,t.index)+i+e.slice(t.index)})),e=(e=e.replace(/\n(\{\{hwt-mark-stop\}\})?$/,"\n\n$1")).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"ie"===this.browser&&(e=e.replace(/ /g," <wbr>")),e=(e=e.replace(/\{\{hwt-mark-start\|(\d+)\}\}/g,(function(e,r){var i=t[+r].className;return i?'<mark class="'+i+'">':"<mark>"}))).replace(/\{\{hwt-mark-stop\}\}/g,"</mark>"),this.$highlights.html(e)},handleScroll:function(){var t=this.$el.scrollTop();this.$backdrop.scrollTop(t);var e=this.$el.scrollLeft();this.$backdrop.css("transform",e>0?"translateX("+-e+"px)":"")},blockContainerScroll:function(){this.$container.scrollLeft(0)},destroy:function(){this.$backdrop.remove(),this.$el.unwrap().removeClass("hwt-text hwt-input").off(r).removeData(r)}},e.fn.highlightWithinTextarea=function(t){return this.each((function(){var n=e(this),s=n.data(r);if("string"==typeof t)if(s)switch(t){case"update":s.handleInput();break;case"destroy":s.destroy();break;default:console.error("unrecognized method string")}else console.error("plugin must be instantiated first");else s&&s.destroy(),(s=new i(n,t)).isGenerated&&n.data(r,s)}))}})();